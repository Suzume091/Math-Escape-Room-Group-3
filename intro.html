<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Math Escape Room Project</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&display=swap" rel="stylesheet">

<style>
  :root{
    --blood-red: #8B0000;
    --blood-glow: rgba(200,0,0,0.6);
    --dark-bg: #050505;
    --panel-bg: rgba(0,0,0,0.7);
    --accent: #FF3B3B;
  }
  html,body { height:100%; margin:0; font-family: Arial, Helvetica, sans-serif; background:#000; color:#eee; background-image: url("data:image/jpeg;base64,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"); background-size: cover; background-position: center;}
  body { overflow:hidden; }

  /* Fullscreen background image container per section */
  .bg {
    position:fixed; inset:0; z-index:-100; background-size:cover; background-position:center; transition: background 0.7s ease;
    filter: brightness(0.5);
  }

  /* central stage */
  .stage {
    position:relative;
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:30px;
    box-sizing:border-box;
  }

  .card {
    width:92%;
    max-width:960px;
    background: var(--panel-bg);
    border-radius:14px;
    padding:22px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.9), inset 0 0 20px rgba(255,0,0,0.03);
    color: #fff;
  }

  /* Scary bloody headers */
  h1.title {
    font-family: 'Creepster', cursive;
    color: var(--accent);
    font-size:48px;
    margin:6px 0 4px 0;
    text-shadow: 0 3px 10px rgba(0,0,0,0.9), 0 0 14px rgba(255,0,0,0.25);
    letter-spacing:1px;
  }
  h2, h3 {
    font-family: 'Nosifer', cursive, 'Creepster', cursive;
    color: var(--accent);
    text-shadow: 0 3px 6px rgba(0,0,0,0.9);
    margin:8px 0;
  }
  p.lead {
    font-size:18px;
    color:#f1e7e7;
    line-height:1.4;
  }

  /* Bloody buttons */
  .bloody-btn {
    display:inline-block;
    padding:12px 22px;
    margin:12px 8px 0 8px;
    border-radius:10px;
    background: linear-gradient(180deg,#550000 0%, #120000 100%);
    border: 2px solid #8b0000;
    box-shadow: 0 6px 25px rgba(139,0,0,0.45), inset 0 -6px 12px rgba(255,0,0,0.08);
    color:#fff;
    font-family: 'Creepster', cursive;
    font-size:18px;
    cursor:pointer;
    text-transform:uppercase;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  .bloody-btn:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 12px 40px rgba(255,0,0,0.45); }

  /* Popups in bloody bubble frame */
  .popup {
    position: fixed;
    left:50%;
    top:50%;
    transform: translate(-50%,-50%);
    z-index: 9999;
    background: linear-gradient(180deg, rgba(10,10,10,0.98), rgba(0,0,0,0.9));
    border-radius: 18px;
    border: 6px solid rgba(100,0,0,0.9);
    padding: 18px;
    width: min(880px, 90%);
    max-height: 80%;
    overflow:auto;
    display:none;
    box-shadow: 0 20px 70px rgba(0,0,0,0.9), 0 0 60px rgba(139,0,0,0.12);
  }
  .popup .bubble {
    background: rgba(20,0,0,0.55);
    border-radius: 12px;
    padding: 12px;
    color: #fff;
    border: 2px solid rgba(255,0,0,0.12);
    font-size:18px;
  }
  .popup h3 { font-family:'Creepster', cursive; color:var(--accent); margin:0 0 8px 0; }

  /* Small utility */
  .hidden { display:none !important; }
  .center { text-align:center; }

  /* Section headers animation */
  .animated-header { opacity:0; transform: translateY(20px); transition: all 0.6s ease; }
  .animated-header.show { opacity:1; transform: translateY(0); }


</style>
</head>
<body>

<div id="bg" class="bg" );"></div>

<div class="stage">
  <div id="mainCard" class="card">
    <!-- We'll inject sections here -->
    <div id="section-title">
      <div class="left"><button class="bloody-btn" onclick="history.back()">&larr;</button></div>
      <h2>You decided to explore an abandoned house.</h2>
      <p class="lead">You are curious about the rumors that says there is a valuable item left at the special room inside but no one can get through. Can you make it 'til the end?</p>
      <div class="center"><button class="bloody-btn" onclick="window.location.href ='intro2.html'">Proceed</button></div>
    </div>

  
  </div>
</div>

  

<!-- NOTE POPUP -->
<div id="notePopup" class="popup">
  <h3>Note</h3>
  <div class="bubble">
    The note says: <br><br>
    <b>"This is the sign used to denote the summation of all terms in a sequence."</b>
  </div>
  <div class="center"><button class="bloody-btn" onclick="closePopup('notePopup')">Close</button></div>
</div>

<!-- LOCK POPUP -->
<div id="lockPopup" class="popup">
  <h3>Pass Lock</h3>
  <div class="bubble center" style="margin-bottom:12px;">
    Choose the symbol which matches the clue.
  </div>
  <div class="center">
    <button class="bloody-btn" onclick="lockWrong('GO AWAY!')">π</button>
    <button class="bloody-btn" onclick="lockWrong('YOU HAVE NO CHANCE!')">Ω</button>
    <button class="bloody-btn" onclick="lockRight()">Σ</button>
  </div>
  <div class="center" style="margin-top:10px;"><button class="bloody-btn" onclick="closePopup('lockPopup')">Close</button></div>
</div>

<!-- LOCK WRONG / RIGHT POPUP -->
<div id="lockWrongPopup" class="popup">
  <h3 id="lockWrongMsg" style="color:red"></h3>
  <div class="center"><button class="bloody-btn" onclick="closePopup('lockWrongPopup')">Close</button></div>
</div>

<div id="lockRightPopup" class="popup">
  <h3 style="color:lightgreen">Luck? maybe...</h3>
  <div class="center"><button class="bloody-btn" onclick="closePopup('lockRightPopup'); proceedAfterLock()">Proceed</button></div>
</div>

<!-- fuse GAME POPUP -->
<div id="fuseGame" class="popup" style="width:95%;max-width:1100px;">
  <h3>Reconnect the fuses</h3>
  <p class="bubble">Drag each colored fuse into the correct socket. When you connect a fuse, a arithmetic mini-puzzle will appear. Solve it to lock that fuse in place. fuses remain visible once connected.</p>

  <div class="mini-game">
    <div class="fuses-area" id="fusesArea">
      <div class="fuse red" draggable="true" id="fuse1" data-fuse="1">fuse 1 (Red)</div>
      <div class="fuse green" draggable="true" id="fuse2" data-fuse="2">fuse 2 (Green)</div>
      <div class="fuse blue" draggable="true" id="fuse3" data-fuse="3">fuse 3 (Blue)</div>
      <div class="fuse yellow" draggable="true" id="fuse4" data-fuse="4">fuse 4 (Yellow)</div>
      <div class="fuse purple" draggable="true" id="fuse5" data-fuse="5">fuse 5 (Purple)</div>
    </div>

    <div class="sockets-area" id="socketsArea">
      <div class="socket" id="socket1" data-socket="1">Socket 1</div>
      <div class="socket" id="socket2" data-socket="2">Socket 2</div>
      <div class="socket" id="socket3" data-socket="3">Socket 3</div>
      <div class="socket" id="socket4" data-socket="4">Socket 4</div>
      <div class="socket" id="socket5" data-socket="5">Socket 5</div>
    </div>
  </div>

  <div style="margin-top:12px;" class="center">
    <button class="bloody-btn" onclick="closePopup('fuseGame')">Close</button>
  </div>
</div>

<!-- mini puzzle popup for fuses -->
<div id="fusePuzzlePopup" class="popup">
  <h3 id="fusePuzzleTitle"></h3>
  <div class="bubble" id="fusePuzzleBody"></div>
  <div style="margin-top:10px;" class="center">
    <input id="fuseAnswer" placeholder="Type answers separated by commas if multiple" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:2px solid rgba(255,255,255,0.04);color:#fff;width:70%;">
  </div>
  <div class="center" style="margin-top:10px;">
    <button class="bloody-btn" onclick="submitfuseAnswer()">Submit</button>
    <button class="bloody-btn" onclick="cancelfuseAttempt()">Cancel</button>
  </div>
  <p id="fuseMsg" class="center small"></p>
</div>

<!-- CABINET AFTER FINISH POPUP -->
<div id="cabinetFinishPopup" class="popup">
  <h3>Cabinet Unlocked</h3>
  <div class="bubble">Inside the cabinet you found a small booklet and a key. The booklet may help later.</div>
  <div class="center" style="margin-top:10px;"><button class="bloody-btn" onclick="closePopup('cabinetFinishPopup'); goToSection('cabinetAfter')">Proceed</button></div>
</div>

<!-- Safe / Wheel popup -->
<div id="safePopup" class="popup">
  <h3>Puzzle Box (Wheel Safe)</h3>
  <div class="wheel-wrap">
    <div class="wheel" id="outerWheel">
      <div class="slot s1" data-index="1">1</div>
      <div class="slot s2" data-index="2">2</div>
      <div class="slot s3" data-index="3">3</div>
      <div class="slot s4" data-index="4">4</div>
      <div class="slot s5" data-index="5">5</div>
      <div class="slot s6" data-index="6">6</div>
      <div class="slot s7" data-index="7">7</div>
      <div class="slot s8" data-index="8">8</div>
      <div class="slot s9" data-index="9">9</div>
    </div>

    <div style="max-width:520px">
      <p class="lead">Find the summation of the given sequences. Each correct numerical answer will be replaced by a symbol. Use the symbols to read the mini-booklet and figure the final word.</p>

      <ol id="sumList">
        <li>5,7,9,11,13,15,17 → <input id="sum1" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>1,2,3,4,5,6,7,8,9 → <input id="sum2" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>0.5,1,1.5,2,2.5,3,3.5,4 → <input id="sum3" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>35,28,21,14,7 → <input id="sum4" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>6,12,18,...,72 → <input id="sum5" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>4,9,14,...,64 → <input id="sum6" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>6,10,14,18,22,26,30 → <input id="sum7" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>35,42,49,56,63,70 → <input id="sum8" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
        <li>8,11,14,17,20,23,26,29 → <input id="sum9" type="text" style="width:120px;padding:6px;border-radius:6px;"></li>
      </ol>

      <div style="margin-top:8px;" class="center">
        <button class="bloody-btn" onclick="checkSums()">Submit Sums</button>
      </div>

      <div style="margin-top:12px;" class="small center">
        <button class="bloody-btn" onclick="openPopup('bookletPopup')">Mini Booklet</button>
      </div>

      <div style="margin-top:10px;" class="center">
        <input id="finalSafeWord" placeholder="Type final word here" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02);border:2px solid rgba(255,255,255,0.04);color:#fff;width:60%;">
        <div style="margin-top:8px;"><button class="bloody-btn" onclick="submitSafeWord()">Submit</button></div>
        <p id="safeMsg" class="small"></p>
      </div>
    </div>
  </div>
  <div class="center" style="margin-top:12px;"><button class="bloody-btn" onclick="closePopup('safePopup')">Close</button></div>
</div>

<!-- Mini booklet popup -->
<div id="bookletPopup" class="popup">
  <h3>Mini Booklet</h3>
  <div class="booklet center">
    <div class="book">
      <div id="pageDisplay" class="page">
        <!-- content injected -->
      </div>
      <div class="book-controls">
        <button class="bloody-btn" onclick="prevPage()">Prev</button>
        <button class="bloody-btn" onclick="nextPage()">Next</button>
      </div>
    </div>
  </div>
  <div class="center" style="margin-top:8px;"><button class="bloody-btn" onclick="closePopup('bookletPopup')">Close</button></div>
</div>

<script>
/* ---------- Global state ---------- */
let currentSection = 'title';
const bg = document.getElementById('bg');

/* helper to change visible section and background */
function hideAllSections(){
  document.querySelectorAll('#mainCard > div').forEach(d => d.classList.add('hidden'));
}
function goToSection(id){
  hideAllSections();
  document.getElementById(id).classList.remove('hidden');
  currentSection = id;
  // change background per section
  switch(id){
    case 'intro1': bg.style.backgroundImage = "url('https://i.ibb.co/wwf3sMb/haunted-house.jpg')"; break;
    case 'intro2': bg.style.backgroundImage = "url('https://i.ibb.co/Z6b0rZb/abandoned-door.jpg')"; break;
    case 'afterLock': bg.style.backgroundImage = "url('https://i.ibb.co/Mc8fK0n/wooden-door.jpg')"; break;
    case 'section1': bg.style.backgroundImage = "url('https://i.ibb.co/9yqkP8V/low-light-entrance.jpg')"; setTimeout(()=>document.getElementById('animatedH').classList.add('show'),150); break;
    case 'basementIntro': bg.style.backgroundImage = "url('https://i.ibb.co/9H0sG4Y/basement.jpg')"; break;
    case 'postfuses': bg.style.backgroundImage = "url('https://i.ibb.co/qkSJQ9t/basement-lit.jpg')"; break;
    case 'cabinetIntro': bg.style.backgroundImage = "url('https://i.ibb.co/jkJ7TzP/cabinet.jpg')"; break;
    case 'cabinetPuzzle': bg.style.backgroundImage = "url('https://i.ibb.co/jkJ7TzP/cabinet.jpg')"; break;
    case 'cabinetAfter': bg.style.backgroundImage = "url('https://i.ibb.co/8K5Qy3G/cabinet-open.jpg')"; break;
    case 'upstairs': bg.style.backgroundImage = "url('https://i.ibb.co/7W7yV6s/hallway.jpg')"; break;
    default: bg.style.backgroundImage = "url('https://i.ibb.co/wwf3sMb/haunted-house.jpg')"; break;
  }
}

/* popup control */
function openPopup(id){ document.getElementById(id).style.display = 'block'; }
function closePopup(id){ document.getElementById(id).style.display = 'none'; }

/* ---------- LOCK logic ---------- */
function lockWrong(msg){
  closePopup('lockPopup');
  document.getElementById('lockWrongMsg').innerText = msg;
  openPopup('lockWrongPopup');
}
function lockRight(){
  closePopup('lockPopup');
  openPopup('lockRightPopup');
}
function proceedAfterLock(){
  closePopup('lockRightPopup');
  goToSection('afterLock');
}

/* ---------- fuse drag & mini puzzles ---------- */
/* map fuse index to puzzle prompt + answers */
const fusePuzzles = {
  1: { prompt: "2, 4, _, _, 32. Type the missing two numbers separated by comma", answers: ["8","16"] },
  2: { prompt: "1, 3, 5, 7, _, _, _. Type the missing three numbers separated by comma", answers: ["9","11","13"] },
  3: { prompt: "7, 14, 21, _, 35, 42, _. Type the two missing numbers separated by comma", answers: ["28","49"] },
  4: { prompt: "3, 9, _, _, 243. Type the two missing numbers separated by comma", answers: ["27","81"] },
  5: { prompt: "81, 72, 63, _, _. Type the two missing numbers separated by comma", answers: ["54","45"] }
};
let fuseConnected = { 1:false,2:false,3:false,4:false,5:false };

/* Setup drag events */
document.querySelectorAll('.fuse').forEach(w=>{
  w.addEventListener('dragstart', e=>{
    e.dataTransfer.setData('text/plain', e.target.id);
  });
});
document.querySelectorAll('.socket').forEach(s=>{
  s.addEventListener('dragover', e=>{
    e.preventDefault();
  });
  s.addEventListener('drop', e=>{
    e.preventDefault();
    const fuseId = e.dataTransfer.getData('text/plain');
    const fuseElem = document.getElementById(fuseId);
    const socketIndex = e.currentTarget.dataset.socket;
    // reject if already connected
    if(e.currentTarget.classList.contains('connected')) return;
    // show mini puzzle for that fuse
    const fuseIndex = parseInt(fuseElem.dataset.fuse,10);
    // start puzzle attempt
    startfusePuzzle(fuseIndex, socketIndex, fuseElem, e.currentTarget);
  });
});

/* fuse puzzle flow */
let ongoingfuse = null;
function startfusePuzzle(fuseIndex, socketIndex, fuseElem, socketElem){
  if(fuseConnected[fuseIndex]) {
    // already solved
    return;
  }
  ongoingfuse = { fuseIndex, socketIndex, fuseElem, socketElem };
  const puz = fusePuzzles[fuseIndex];
  document.getElementById('fusePuzzleTitle').innerText = "Mini Puzzle for fuse " + fuseIndex;
  document.getElementById('fusePuzzleBody').innerText = puz.prompt;
  document.getElementById('fuseAnswer').value = '';
  document.getElementById('fuseMsg').innerText = '';
  openPopup('fusePuzzlePopup');
}

/* submit fuse answer */
function submitfuseAnswer(){
  const ans = document.getElementById('fuseAnswer').value.trim();
  if(!ongoingfuse) return;
  const expected = fusePuzzles[ongoingfuse.fuseIndex].answers;
  // normalize: split and trim
  const provided = ans.split(',').map(s=>s.trim()).filter(s=>s.length>0);
  // require same length and exact numbers
  if(provided.length !== expected.length){
    indicatefuseWrong();
    return;
  }
  // check each element numeric equality
  let ok = true;
  for(let i=0;i<expected.length;i++){
    if(provided[i] !== expected[i]) { ok = false; break; }
  }
  if(!ok){
    indicatefuseWrong();
    return;
  }
  // correct: lock fuse in socket
  closePopup('fusePuzzlePopup');
  lockfuseIntoSocket(ongoingfuse.fuseElem, ongoingfuse.socketElem, ongoingfuse.fuseIndex);
  ongoingfuse = null;
  // check if all fuses connected
  if(Object.values(fuseConnected).every(v=>v)) {
    // show proceed button in the fuseGame popup (or close and proceed)
    closePopup('fuseGame');
    openPopup('cabinetFinishPopup');
  }
}
function indicatefuseWrong(){
  document.getElementById('fuseMsg').innerText = "Incorrect — try again.";
  const ansInput = document.getElementById('fuseAnswer');
  ansInput.classList.add('shake');
  setTimeout(()=>ansInput.classList.remove('shake'),600);
}
function cancelfuseAttempt(){
  ongoingfuse = null;
  closePopup('fusePuzzlePopup');
}
function lockfuseIntoSocket(fuseElem, socketElem, fuseIndex){
  // visually move fuse text into socket; ensure fuse stays visible
  socketElem.classList.add('connected');
  socketElem.innerText = fuseElem.innerText;
  fuseConnected[fuseIndex] = true;
  // disable dragging
  fuseElem.draggable = false;
  fuseElem.style.opacity = 0.45;
  fuseElem.style.cursor = 'default';
  // attach data attribute to socket for later use if needed
  socketElem.dataset.lockedfuse = fuseIndex;
}

/* ---------- Cabinet tables logic ---------- */
/* Precomputed correct answers for left-hand questions.
   We'll compute them or hardcode according to the problems described.
   1) "Arithmetic Series 3,6,...,30" -> sum of that list (10 terms) = arithmetic sum:
      a1=3, an=30, n=10 => S = n*(a1+an)/2 = 10*(3+30)/2 = 10*33/2 = 165
   2) Sum first 6 terms when a1=2,d=3: a6 = 2 + (6-1)*3=17 => S=6*(2+17)/2 = 6*19/2=57
   3) d=4,a1=4,a7 = a1+(7-1)*4 = 4+24=28
   4) geometric r=3,a1=9, a5 = 9 * 3^(5-1) = 9 * 81 = 729
   5) if a8 = 159 and d=25, then a8 = a1 + 7d => a1 = 159 - 7*25 = 159 - 175 = -16. Then a4 = a1 + 3d = -16 + 75 = 59
   6) sum first 10 odd numbers -> first 10 odd numbers are 1..19 odd => sum = n^2 = 10^2 = 100
   7) sum first 8 even numbers -> even numbers: 2,4,...,16 => sum = n(n+1) = 8*9 = 72
   8) sum first 4 multiples of 5 => 5+10+15+20 = 50
*/
const cabinetCorrect = {
  q1: 165, q2: 57, q3: 28, q4: 729, q5: 59, q6: 100, q7: 72, q8: 50
};
/* mapping from which correct numeric answer triggers which letter placement in the RIGHT table:
   Based on the user's mapping in prompt:
   When they got the right answer, the box will be replaced by permanent letter mapping:
   q1 -> replace l5 with 'S' (165)
   q2 -> replace l3 with 'N' (57)
   q3 -> replace l6 with 'E' (28)
   q4 -> replace l7 with 'E' (729)
   q5 -> replace l4 with 'U' (59)
   q6 -> replace l1 with 'Q' (100)
   q7 -> replace l8 with 'C' (72)
   q8 -> replace l2 with 'E' (50)
*/
const cabinetMapping = {
  q1: 'l5', q2: 'l3', q3: 'l6', q4: 'l7', q5: 'l4', q6: 'l1', q7: 'l8', q8: 'l2'
};
const cabinetLetterForQuestion = {
  q1: 'S', q2: 'N', q3: 'E', q4: 'E', q5: 'U', q6: 'Q', q7: 'C', q8: 'E'
};

function checkCabinetTable(){
  // iterate and check
  let allCorrect = true;
  for(let i=1;i<=8;i++){
    const id = 'q' + i;
    const val = document.getElementById(id).value.trim();
    if(val === '') { allCorrect = false; continue; }
    // parse to number
    const num = Number(val);
    if(num === cabinetCorrect[id]){
      // place permanent letter
      const letterCell = cabinetMapping[id];
      const letter = cabinetLetterForQuestion[id];
      const target = document.getElementById(letterCell + 'cell') || document.getElementById(letterCell + 'cell');
      // replace input with permanent letter visually
      const inputElem = document.getElementById(letterCell);
      if(inputElem){
        inputElem.value = letter;
        inputElem.disabled = true;
        inputElem.style.background = 'rgba(255,255,255,0.03)';
        inputElem.style.color = '#fff';
        inputElem.style.fontWeight = 'bold';
      }
    } else {
      allCorrect = false;
      // show shake for that input
      const inputElem = document.getElementById(id);
      inputElem.classList.add('shake');
      setTimeout(()=>inputElem.classList.remove('shake'),600);
    }
  }
  const msg = document.getElementById('cabinetMsg');
  if(allCorrect){
    msg.innerText = "All numeric answers correct! Now fill the final word using the revealed letters.";
    // disable question inputs
    for(let i=1;i<=8;i++){ document.getElementById('q'+i).disabled = true; }
  } else {
    msg.innerText = "Some answers are incorrect or missing. Wrong inputs will shake.";
  }
}

/* final word check for cabinet: required 'SEQUENCE' */
function checkFinalWord(){
  const val = document.getElementById('finalWord').value.trim().toUpperCase();
  const msg = document.getElementById('cabinetMsg');
  if(val === 'SEQUENCE'){
    msg.innerText = "Correct! Cabinet yields a mini-booklet and a key.";
    openPopup('cabinetFinishPopup');
    // mark as done and allow proceed
  } else {
    // shake input
    const el = document.getElementById('finalWord');
    el.classList.add('shake');
    setTimeout(()=>el.classList.remove('shake'),600);
    msg.innerText = "Wrong final word.";
  }
}

/* ---------- Booklet & Safe sums logic ---------- */
/* For the wheel / sums, user gave specific answers and mapping to symbols 1..9 */
const sumsCorrect = {
  sum1: 77,
  sum2: 45,
  sum3: 18,
  sum4: 105,
  sum5: 468,
  sum6: 442,
  sum7: 124,
  sum8: 315,
  sum9: 148
};
/* mapping numeric->symbol index */
const sumToSymbol = {
  77: 1, 45: 2, 18:3, 105:4, 468:5, 442:6, 124:7, 315:8, 148:9
};
/* symbol to animal mapping as described */
const symbolToAnimal = {
  1: 'horse', 2:'tiger', 3:'rat', 4:'snake', 5:'boar', 6:'ram', 7:'dragon', 8:'dog', 9:'hen'
};
/* the booklet pages (user-specified mapping of symbol->letter)
  For the 1st Page, put the same symbol for the 'rat' then write big E
  2nd Page -> hen -> M
  3rd -> boar -> G
  4th -> horse -> O
  5th -> dog -> C
  6th -> snake -> I
  7th -> tiger -> T
  8th -> dragon -> R
  9th -> ram -> E
  The booklet pages order (1..9) correspond to symbol index order 3,9,5,1,8,4,2,7,6 (rat,hen,boar,horse,dog,snake,tiger,dragon,ram)
  The letters corresponding: E M G O C I T R E
  The right final word after solving is GEOMETRIC (user says)
*/
const bookletPages = [
  { symbol:'rat', letter:'O' },   // page 1
  { symbol:'hen', letter:'C' },   // 2
  { symbol:'boar', letter:'E' },  // 3
  { symbol:'horse', letter:'G' }, // 4
  { symbol:'dog', letter:'I' },   // 5
  { symbol:'snake', letter:'M' }, // 6
  { symbol:'tiger', letter:'E' }, // 7
  { symbol:'dragon', letter:'R' },// 8
  { symbol:'ram', letter:'T' }    // 9
];
let currentPageIndex = 0;

/* display booklet page */
function renderPage(idx){
  const display = document.getElementById('pageDisplay');
  const pg = bookletPages[idx];
  display.innerHTML = `<div style="font-size:28px;opacity:0.8">${pg.symbol.toUpperCase()}</div><div style="font-size:84px;margin-top:8px">${pg.letter}</div>`;
}
function prevPage(){ if(currentPageIndex>0){ currentPageIndex--; renderPage(currentPageIndex); } }
function nextPage(){ if(currentPageIndex<bookletPages.length-1){ currentPageIndex++; renderPage(currentPageIndex); } }

/* check sums and map them to the wheel (replace input with symbol if correct) */
function checkSums(){
  let allCorrect = true;
  for(let i=1;i<=9;i++){
    const id = 'sum' + i;
    const v = document.getElementById(id).value.trim();
    if(v === '') { allCorrect = false; document.getElementById(id).classList.add('shake'); setTimeout(()=>document.getElementById(id).classList.remove('shake'),600); continue; }
    const num = Number(v);
    if(num === sumsCorrect[id]){
      // replace input with symbol on the page (map the numeric to symbol index)
      const symbolIndex = sumToSymbol[num];
      // Put small symbol label in the wheel slot corresponding to that numeric mapping (we use mapping given earlier: numbers -> symbol index -> place 1..9)
      // The user defined mapping 1->horse, 2->tiger... but we will place the animal icon text in the slot for index= symbolIndex.
      // Find the slot with data-index = symbolIndex and place animal name
      const slot = document.querySelector('.slot[data-index="'+symbolIndex+'"]');
      if(slot) {
        slot.innerText = symbolToAnimal[symbolIndex];
      }
      // disable input
      document.getElementById(id).disabled = true;
      document.getElementById(id).style.background = 'rgba(255,255,255,0.02)';
    } else {
      allCorrect = false;
      const el = document.getElementById(id);
      el.classList.add('shake');
      setTimeout(()=>el.classList.remove('shake'),600);
    }
  }
  if(allCorrect){
    document.getElementById('safeMsg').innerText = "All sums correct! Now use the Mini Booklet to find the final word.";
  } else {
    document.getElementById('safeMsg').innerText = "Some sums incorrect. Wrong inputs shake.";
  }
}

/* submit safe final word: must be GEOMETRIC */
function submitSafeWord(){
  const v = (document.getElementById('finalSafeWord').value || '').trim().toUpperCase();
  if(v === 'GEOMETRIC'){
    document.getElementById('safeMsg').innerText = "Correct! You've unlocked the puzzle box and found the key.";
    closePopup('safePopup');
    goToSection('ssection4');
  } else {
    const el = document.getElementById('finalSafeWord');
    el.classList.add('shake');
    setTimeout(()=>el.classList.remove('shake'),600);
    document.getElementById('safeMsg').innerText = "Wrong. Try again.";
  }
}

/* ---------- Safe popup Booklet open on load ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  renderPage(0);
  // Start at title
  hideAllSections();
  document.getElementById('section-title').classList.remove('hidden');
});

/* ---------- Final/Restart ---------- */
function restartGame(){
  window.location.reload();
}

/*-------- Sudoku Section ----------*/
// Predefined valid 6x6 grid with 3x3 quadrants
const solution = [
  [1,2,3,4,5,6],
  [4,5,6,1,2,3],
  [2,3,1,5,6,4],
  [5,6,4,2,3,1],
  [3,1,2,6,4,5],
  [6,4,5,3,1,2]
];

// Randomly remove 9 cells for blanks
let blanks = [];
while (blanks.length < 9) {
  let r = Math.floor(Math.random() * 6);
  let c = Math.floor(Math.random() * 6);
  let key = r + "-" + c;
  if (!blanks.includes(key)) blanks.push(key);
}

const table = document.getElementById("sudokuTable");

for (let i = 0; i < 6; i++) {
  let tr = document.createElement("tr");
  for (let j = 0; j < 6; j++) {
    let td = document.createElement("td");
    // Add quadrant borders
    if (j === 2) td.classList.add("quad-right");
    if (i === 2) td.classList.add("quad-bottom");

    if (blanks.includes(i + "-" + j)) {
      let input = document.createElement("input");
      input.setAttribute("type", "text");
      input.setAttribute("maxlength", "1");
      input.dataset.row = i;
      input.dataset.col = j;
      input.addEventListener("input", (e) => {
        let val = e.target.value;
        if (!/^[1-6]$/.test(val)) e.target.value = "";
      });
      td.appendChild(input);
    } else {
      td.textContent = solution[i][j];
    }
    tr.appendChild(td);
  }
  table.appendChild(tr);
}

function checkSolution() {
  let valid = true;

  // Helper to get quadrant indices
  function getQuadrant(r,c) {
    let quadRow = r < 3 ? 0 : 1;
    let quadCol = c < 3 ? 0 : 1;
    return {quadRow, quadCol};
  }

  const inputs = document.querySelectorAll("input");
  for (let input of inputs) {
    let val = parseInt(input.value);
    let r = parseInt(input.dataset.row);
    let c = parseInt(input.dataset.col);
    if (!val || val < 1 || val > 6) valid = false;

    // Check row
    for (let i = 0; i < 6; i++) {
      if (i !== c) {
        let cell = document.querySelector(`tr:nth-child(${r+1}) td:nth-child(${i+1}) input`);
        if (cell && parseInt(cell.value) === val) valid = false;
      }
    }
    // Check column
    for (let i = 0; i < 6; i++) {
      if (i !== r) {
        let cell = document.querySelector(`tr:nth-child(${i+1}) td:nth-child(${c+1}) input`);
        if (cell && parseInt(cell.value) === val) valid = false;
      }
    }
    // Check quadrant
    let {quadRow, quadCol} = getQuadrant(r,c);
    for (let i = quadRow*3; i < quadRow*3+3; i++) {
      for (let j = quadCol*3; j < quadCol*3+3; j++) {
        if (i===r && j===c) continue;
        let cell = document.querySelector(`tr:nth-child(${i+1}) td:nth-child(${j+1}) input`);
        if (cell && parseInt(cell.value) === val) valid = false;
      }
    }
  }

  if (valid) alert("Congratulations! Your solution is valid.");
  else alert("There are errors in your solution. Check rows, columns, and quadrants.");
}

/* Accessibility note: Close popups with ESC */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    document.querySelectorAll('.popup').forEach(p=>p.style.display='none');
  }
});

</script>
</body>

</html>
